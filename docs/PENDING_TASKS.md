# 待处理任务记录功能

## 功能概述

在 i18n 自动转换过程中，部分中文字符串可能因为各种原因无法自动转换成功。为了方便开发者手动处理这些失败的转换，工具会自动生成一个单独的**待处理任务记录文件**。

## 功能特点

### 1. 自动生成
- 在执行 `full` 命令（完整流程）时自动生成
- 只有当存在失败或跳过的记录时才会生成文件
- 生成两种格式：Markdown（方便阅读）和 JSON（方便程序化处理）

### 2. 详细记录
待处理任务文件包含以下信息：

#### 转换失败记录
- 文件路径
- 行号
- 原始中文文本
- 失败原因
- 发生时间
- 处理状态复选框

#### 跳过处理记录
- 按跳过原因分类
- 文件路径和行号
- 文本内容
- 所在区域（template/script/etc）
- 处理状态复选框

### 3. 处理建议
文件中包含详细的处理建议，帮助开发者快速解决问题：
- 常见失败原因的解决方案
- 跳过处理项的检查要点
- 完整的手动处理流程

## 使用方法

### 执行转换
```bash
node src/index.js full
```

### 查看生成的文件
转换完成后，待处理任务文件会保存在 `output` 目录下：

```
output/
├── pending-tasks-2025-12-04T07-35-44.md    # Markdown格式（推荐阅读）
├── pending-tasks-2025-12-04T07-35-44.json  # JSON格式（程序处理）
└── i18n-extracted-2025-12-04_07-35-44.json # 提取结果
```

### 手动处理流程

1. **打开 Markdown 文件**
   ```bash
   # 使用 VS Code 打开
   code output/pending-tasks-*.md
   ```

2. **查看统计信息**
   - 了解总共有多少项需要处理
   - 区分转换失败和跳过处理的数量

3. **处理转换失败的项目**
   - 定位到文件和行号
   - 根据失败原因选择处理方式
   - 完成后在复选框中打勾 `[x]`

4. **检查跳过处理的项目**
   - 判断是否真的需要国际化
   - 如果需要，手动添加 i18n 调用
   - 完成后在复选框中打勾 `[x]`

## 配置选项

在 `config.json` 中可以配置待处理任务记录的行为：

```json
{
  "pendingTasks": {
    "enabled": true,                        // 是否启用待处理任务记录
    "outputFormat": ["markdown", "json"],   // 输出格式
    "includeSkipped": true,                 // 是否包含跳过的记录
    "includeFailed": true                   // 是否包含失败的记录
  }
}
```

## 文件格式说明

### Markdown 格式
易于阅读和编辑的格式，包含：
- 📊 统计概览
- ❌ 转换失败列表（按文件分组）
- ⏭️ 跳过处理列表（按原因分组）
- 💡 处理建议和流程指导

### JSON 格式
便于程序化处理的格式，包含：
```json
{
  "generatedAt": "2025-12-04T07:35:44.000Z",
  "summary": {
    "failed": 5,
    "skipped": 12,
    "total": 17
  },
  "failed": [
    {
      "original": "提交订单",
      "filePath": "src/views/Order.vue",
      "line": 123,
      "reason": "未找到匹配的文本",
      "timestamp": "2025-12-04T07:35:44.000Z"
    }
  ],
  "skipped": [
    {
      "text": "price",
      "filePath": "src/views/Product.vue",
      "section": "script",
      "line": 45,
      "reason": "变量引用",
      "timestamp": "2025-12-04T07:35:44.000Z"
    }
  ]
}
```

## 常见问题

### Q1: 为什么会有转换失败？
**A:** 常见原因包括：
- 文本在替换前被修改过
- 包含特殊字符导致匹配失败
- 文本格式复杂（如多行文本、包含引号等）
- 动态拼接的字符串

### Q2: 跳过处理的内容是否需要国际化？
**A:** 需要根据具体情况判断：
- **变量引用**：检查变量值是否为固定中文文本
- **注释内容**：通常不需要国际化，但技术文档注释可能需要
- **特殊格式**：数字、日期等需要使用特定的国际化方法

### Q3: 如何快速定位问题代码？
**A:** 使用 VS Code 的快速导航：
1. 按 `Ctrl+P`（Windows）或 `Cmd+P`（Mac）
2. 输入文件路径
3. 输入 `:行号` 跳转到指定行

### Q4: 处理完成后如何验证？
**A:** 运行验证命令：
```bash
node src/index.js validate
```

## 示例

### 示例 1: 处理转换失败的文本

**待处理记录：**
```markdown
### 1. `src/views/Order.vue`

- **行号**: 123
  - **原文**: `提交订单`
  - **原因**: 未找到匹配的文本
  - **处理状态**: [ ] 待处理
```

**处理方法：**
1. 打开 `src/views/Order.vue`，跳转到第 123 行
2. 找到 `提交订单` 相关代码
3. 手动修改为：
   ```vue
   <el-button @click="submitOrder">{{ $t('order.submit') }}</el-button>
   ```
4. 在 i18n 配置文件中添加对应的 key：
   ```javascript
   {
     "order": {
       "submit": "提交订单"
     }
   }
   ```
5. 在待处理记录中标记为完成：`[x]`

### 示例 2: 检查跳过处理的变量

**待处理记录：**
```markdown
- **行号 45**: `message`
  - **区域**: script
  - **处理状态**: [ ] 待处理
```

**检查方法：**
1. 查看 `message` 变量的使用
2. 如果是固定文本：
   ```javascript
   // 修改前
   const message = '操作成功'
   
   // 修改后
   const message = this.$t('common.success')
   ```
3. 如果是真正的动态变量，可以标记为 `[x]` 无需处理

## 相关命令

```bash
# 执行完整流程（包含生成待处理任务）
node src/index.js full

# 仅验证转换结果
node src/index.js validate

# 查看日志文件
cat logs/i18n-conversion-*.log

# 查看待处理任务
cat output/pending-tasks-*.md
```

## 技术实现

待处理任务记录功能在 `src/utils/logger.js` 中实现：

```javascript
// 生成待处理任务文件
logger.generatePendingTasks(outputDir)
```

该方法会：
1. 检查是否有失败或跳过的记录
2. 如果有，生成 Markdown 和 JSON 格式的文件
3. 返回生成的文件路径
4. 在控制台显示文件位置

## 最佳实践

1. **及时处理**：每次转换后立即查看并处理待处理任务
2. **优先级排序**：先处理转换失败的，再检查跳过的
3. **批量处理**：对于同类问题，可以批量处理提高效率
4. **验证测试**：处理完成后运行验证命令确保没有遗漏
5. **保存记录**：将已完成的待处理文件存档，便于追溯

## 更新日志

- **2025-12-04**: 初始版本发布
  - 支持 Markdown 和 JSON 格式输出
  - 包含详细的处理建议
  - 提供复选框追踪处理状态
